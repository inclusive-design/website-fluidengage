jQuery.cookie=function(name,value,options){if(typeof value!="undefined"){options=options||{};if(value===null){value="";options.expires=-1}var expires="";if(options.expires&&(typeof options.expires=="number"||options.expires.toUTCString)){var date;if(typeof options.expires=="number"){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000))}else{date=options.expires}expires="; expires="+date.toUTCString()}var path=options.path?"; path="+(options.path):"";var domain=options.domain?"; domain="+(options.domain):"";var secure=options.secure?"; secure":"";document.cookie=[name,"=",encodeURIComponent(value),expires,path,domain,secure].join("")}else{var cookieValue=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+"=")){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}};"use strict";var fluid=fluid||{};fluid.engage=fluid.engage||{};fluid.engage.user=fluid.engage.user={};(function($){fluid.engage.setCookie=function(name,value,options){value=JSON.stringify(value);$.cookie(name,value,options)};fluid.engage.deleteCookie=function(name){$.cookie(name,null)};fluid.engage.getCookie=function(name){var cookie=$.cookie(name);return cookie?JSON.parse(cookie):null};var buildUserServiceURL=function(id){var idParam=id?("?id="+id):"";return"../users/users.json"+idParam};var ajax=function(id,data,type,success){$.ajax({url:buildUserServiceURL(id),async:false,data:data?JSON.stringify(data):{},dataType:"json",type:type,success:success,error:function(xhr,textStatus,errorThrown){fluid.log("XHR: "+xhr);fluid.log("Status: "+textStatus);fluid.log("Error: "+errorThrown)}})};fluid.engage.user.fetchUser=function(id){var user;ajax(id,null,"GET",function(data){user=data});return user};fluid.engage.user.createNewUser=function(){var user={type:"user",collection:{artifacts:[]}};ajax("NEW_DOC",user,"PUT",function(data){user._id=data.id});return user};fluid.engage.user.currentUser=function(){var cookieId=fluid.engage.getCookie("engage.uuid");if(cookieId){return fluid.engage.user.fetchUser(cookieId)}else{var user=fluid.engage.user.createNewUser();fluid.engage.setCookie("engage.uuid",user._id,{path:"/"});return user}}})(jQuery);var fluid=fluid||{};(function($,fluid){fluid.kettle=fluid.kettle||{};fluid.makeArray=function(array){return $.makeArray(array===undefined?null:array)};fluid.generate=function(n,generator){var togo=[];for(var i=0;i<n;++i){togo[i]=typeof (generator)==="function"?generator.call(null,i):generator}return togo};function push(hash,key,value){var exist=hash[key];if(!exist){hash[key]=value}else{if(typeof (exist)==="string"){hash[key]=[exist,value]}else{if(typeof (exist).length==="number"){exist[exist.length]=value}}}}fluid.kettle.decodeURIComponent=function(comp){comp=comp.replace(/\+/g," ");return decodeURIComponent(comp)};fluid.kettle.paramsToMap=function(queryString){var togo={};queryString=queryString||"";if(queryString.charAt(0)==="?"){queryString=queryString.substring(1)}var segs=queryString.split("&");for(var i=0;i<segs.length;++i){var seg=segs[i];var eqpos=seg.indexOf("=");var key=seg.substring(0,eqpos);var value=seg.substring(eqpos+1);push(togo,fluid.kettle.decodeURIComponent(key),fluid.kettle.decodeURIComponent(value))}return togo};fluid.kettle.parsePathInfo=function(pathInfo){var togo={};var segs=pathInfo.split("/");if(segs.length>0){var top=segs.length-1;var dotpos=segs[top].indexOf(".");if(dotpos!==-1){togo.extension=segs[top].substring(dotpos+1);segs[top]=segs[top].substring(0,dotpos)}}togo.pathInfo=segs;return togo};fluid.kettle.splitUrl=function(url){var qpos=url.indexOf("?");if(qpos===-1){return{path:url}}else{return{path:url.substring(0,qpos),query:url.substring(qpos+1)}}};fluid.kettle.parseUrl=function(url){var split=fluid.kettle.splitUrl(url);togo=fluid.kettle.parsePathInfo(split.path);if(split.query){togo.params=fluid.kettle.paramsToMap(split.query)}return togo};fluid.kettle.renderUrl=function(parsed){var togo=fluid.kettle.makeRelPath(parsed);if(parsed.params){togo+="?"+$.param(parsed.params)}return togo};fluid.kettle.addParamsToUrl=function(url,addParams){var parsed=fluid.kettle.parseUrl(url);parsed.params=$.extend(parsed.params||{},addParams);return fluid.kettle.renderUrl(parsed)};fluid.kettle.collapseSegs=function(segs,from,to){var togo="";if(from===undefined){from=0}if(to===undefined){to=segs.length}for(var i=from;i<to-1;++i){togo+=segs[i]+"/"}togo+=segs[to-1];return togo};fluid.kettle.makeRelPath=function(parsed,index){var togo=fluid.kettle.collapseSegs(parsed.pathInfo,index);if(parsed.extension){togo+="."+parsed.extension}return togo};fluid.kettle.cononocolosePath=function(pathInfo){var consume=0;for(var i=0;i<pathInfo.length;++i){if(pathInfo[i]===".."){++consume}else{if(consume!==0){pathInfo.splice(i-consume*2,consume*2);i-=consume*2;consume=0}}}return pathInfo};fluid.kettle.makeCanon=function(compound){var parsed=fluid.kettle.parsePathInfo(compound);fluid.kettle.cononocolosePath(parsed.pathInfo);return fluid.kettle.makeRelPath(parsed)};fluid.kettle.operateUrl=function(url,responseParser,writeDispose,callback){var togo={};responseParser=responseParser||fluid.identity;function success(responseText,textStatus){togo.data=responseParser(responseText);togo.textStatus=textStatus;if(callback){callback(togo)}}function error(xhr,textStatus,errorThrown){fluid.log("Data fetch error - textStatus: "+textStatus);fluid.log("ErrorThrown: "+errorThrown);togo.textStatus=textStatus;togo.errorThrown=errorThrown;togo.isError=true;if(callback){callback(togo)}}var ajaxOpts={type:"GET",url:url,success:success,error:error};if(writeDispose){$.extend(ajaxOpts,writeDispose)}fluid.log("Issuing request for "+ajaxOpts.type+" of URL "+ajaxOpts.url);$.ajax(ajaxOpts);fluid.log("Request returned");return togo};fluid.kettle.resolveEnvironment=fluid.identity;fluid.kettle.URLDataSource=function(options){fluid.log("Creating URLDataSource with writeable = "+options.writeable);function resolveUrl(resOptions,directModel){var expanded=fluid.kettle.resolveEnvironment(resOptions,directModel);if(expanded.funcName){return fluid.invokeGlobalFunction(expanded.funcName,$.makeArray(expanded.args))}}var that=fluid.initLittleComponent("fluid.kettle.URLDataSource",options);that.get=function(directModel){var url=resolveUrl(that.options.urlBuilder,directModel);if(url){return fluid.kettle.operateUrl(url,fluid.kettle.JSONParser)}};if(that.options.writeable){that.put=function(model,directModel,callback){var url=resolveUrl(that.options.urlBuilder,directModel);var expanded=fluid.kettle.resolveEnvironment(that.options,directModel);var ajaxOpts={data:JSON.stringify(model),contentType:"application/json; charset=UTF-8"};if(model._id===undefined){ajaxOpts.type="POST"}else{ajaxOpts.type="PUT";if(that.options.couchDBDocumentURL){url=url+encodeURIComponent(model._id)}}return fluid.kettle.operateUrl(url,fluid.kettle.JSONParser,ajaxOpts,callback)}}return that};fluid.defaults("fluid.kettle.URLDataSource",{couchDBDocumentURL:true});fluid.kettle.dummyDataSource=function(initModel){return{get:function(){return initModel},put:function(){}}};fluid.kettle.simpleURLDataSource=function(url){return url?fluid.kettle.URLDataSource({writeable:true,couchDBDocumentURL:false,urlBuilder:{funcName:"fluid.identity",args:url}}):fluid.kettle.dummyDataSource};fluid.kettle.makeSourceApplier=function(dataSource,directModel,model){if(model===undefined){model=dataSource.get(directModel)}var baseApplier=fluid.makeChangeApplier(model);var changed=fluid.event.getEventFirer();var togo={fireChangeRequest:function(dar){baseApplier.fireChangeRequest(dar);dataSource.put(model,directModel,function(arg){changed.fire(arg)})},modelChanged:changed};fluid.model.bindRequestChange(togo);return togo};var BEGIN_KEY="<!--DISREPUTABLE TEMPLATE BOUNDARY-->";fluid.kettle.stripTemplateQuickly=function(text){var bl=BEGIN_KEY.length;var i1=text.indexOf(BEGIN_KEY);var i2=text.indexOf(BEGIN_KEY,i1+bl);if(i1===-1||i2===-1){fluid.fail("Template boundary not found within file")}return text.substring(i1+bl,i2)};fluid.kettle.fetchTemplateSection=function(url){return fluid.kettle.operateUrl(url,fluid.kettle.stripTemplateQuickly,{async:false})}})(jQuery,fluid);"use strict";var fluid=fluid||{};fluid.engage=fluid.engage||{};fluid.engage.url=fluid.engage.url||{};(function($){var getScreenNavigatorSingleton=function(){if(fluid.engage.screenNavigator){return fluid.engage.screenNavigator.get()}return null};var getLocation=function(){var nav=getScreenNavigatorSingleton();return nav?"/"+nav.currentURL:window.location.href};var setLocation=function(url){var nav=getScreenNavigatorSingleton();if(nav){if(url.charAt(0)==="/"){nav.setLocation(url.substring(1))}else{nav.setRelativeLocation(url)}}else{window.location=url}return url};var busy=false;var queue=[];function execQueue(){for(var i=0;i<queue.length;++i){queue[i]()}queue=[]}fluid.engage.url.deferUntilQuiet=function(func){if(!busy){func()}else{queue.push(func)}};fluid.engage.url.setBusy=function(newBusy){busy=newBusy;if(!newBusy&&queue.length){execQueue()}};fluid.engage.url.location=function(url){return(typeof (url)==="undefined")?getLocation():setLocation(url)};fluid.engage.url.history={go:function(num){history.go(num)},back:function(){fluid.engage.url.history.go(-1)},forward:function(){fluid.engage.url.history.go(1)}};fluid.engage.url.parseSearch=function(url){var qIdx=url.indexOf("?");var hashIdx=url.indexOf("#");if(qIdx===-1){return null}return url.substring(qIdx,(hashIdx>-1)?hashIdx:url.length)};fluid.engage.url.search=function(){var nav=getScreenNavigatorSingleton();return nav?fluid.engage.url.parseSearch(nav.currentURL):window.location.search};fluid.engage.url.params=function(){var search=fluid.engage.url.search();return fluid.kettle.paramsToMap(search)};fluid.engage.url.addParamToURL=function(url,param,value){var urlBase=url;var trimURL=function(idx){var trimmed;if(idx!==-1){trimmed=url.substring(idx);urlBase=urlBase.substring(0,idx)}return trimmed};var hash=trimURL(url.indexOf("#"))||"";var q=trimURL(url.indexOf("?"))||"";var params=q?fluid.kettle.paramsToMap(q):{};params[param]=value;return urlBase+"?"+$.param(params)+hash}})(jQuery);"use strict";var fluid=fluid||{};fluid.engage=fluid.engage||{};(function($){fluid.engage.renderUtils=fluid.engage.renderUtils||{};fluid.engage.renderUtils.createRendererFunction=function(container,selectors,options){options=options||{};container=$(container);var source=options.templateSource?options.templateSource:{node:container};var rendererOptions=options.rendererOptions||{};var templates=null;return function(tree){var cutpointFn=options.cutpointGenerator||"fluid.engage.renderUtils.selectorsToCutpoints";rendererOptions.cutpoints=rendererOptions.cutpoints||fluid.invokeGlobalFunction(cutpointFn,[selectors,options]);if(templates){fluid.reRender(templates,container,tree,rendererOptions)}else{templates=fluid.render(source,container,tree,rendererOptions)}}};fluid.engage.renderUtils.removeSelectors=function(selectors,selectorsToIgnore){if(selectorsToIgnore){$.each(selectorsToIgnore,function(index,selectorToIgnore){delete selectors[selectorToIgnore]})}return selectors};fluid.engage.renderUtils.markRepeated=function(selector,repeatingSelectors){if(repeatingSelectors){$.each(repeatingSelectors,function(index,repeatingSelector){if(selector===repeatingSelector){selector=selector+":"}})}return selector};fluid.engage.renderUtils.selectorsToCutpoints=function(selectors,options){var cutpoints=[];options=options||{};selectors=fluid.copy(selectors);if(options.selectorsToIgnore){selectors=fluid.engage.renderUtils.removeSelectors(selectors,options.selectorsToIgnore)}for(var selector in selectors){cutpoints.push({id:fluid.engage.renderUtils.markRepeated(selector,options.repeatingSelectors),selector:selectors[selector]})}return cutpoints};fluid.renderer.mergeComponents=function(target,source){for(var key in source){target[key]=source[key]}return target};fluid.renderer.makeProtoExpander=function(options){var ELstyle=options.ELstyle;var IDescape=options.IDescape||"\\";function extractEL(string){if(ELstyle==="ALL"){return string}else{if(ELstyle.length===1){if(string.charAt(0)===ELstyle){return string.substring(1)}}else{if(ELstyle==="${}"){var i1=string.indexOf("${");var i2=string.indexOf("}");if(i1===0&&i2!==-1){return string.substring(2,i2)}}}}}function expandStringEntry(proto,string){var EL=options.ELstyle?extractEL(string):null;if(EL){proto.valuebinding=EL}else{proto.value=string}}var expandMembers=function(proto,container,pusher){for(var key in proto){var entry=proto[key];var comp;if(key==="decorators"){container.decorators=entry;continue}if(key.charAt(0)===IDescape){key=key.substring(1)}if(entry&&entry.children){if(key.indexOf(":")===-1){key=key+":"}var children=entry.children;for(var i=0;i<children.length;++i){comp=expandChildren(children[i]);pusher(comp,key)}}else{if(typeof (entry)==="string"||!fluid.isPrimitive(entry)){comp=fluid.freshContainer(entry);expandComponent(comp,entry);pusher(comp,key)}else{if(entry!==undefined){pusher(entry,key)}}}}};var expandChildren=function(proto){var childlist=[];var togo={children:childlist};var childPusher=function(comp,key){comp.ID=key;childlist.push(comp)};expandMembers(proto,togo,childPusher);return togo};function expandComponent(comp,entry){function memberPusher(component,key){comp[key]=component}if(typeof (entry)==="string"){expandStringEntry(comp,entry)}else{expandMembers(entry,comp,memberPusher)}}return expandChildren}})(jQuery);"use strict";fluid=fluid||{};fluid.engage=fluid.engage||{};(function($){var preventingHandler=function(fn){return function(evt){fn();evt.preventDefault()}};var setupToggle=function(that){that.defaultIcon=that.locate("toggleDefaultIcon").show();that.alternateIcon=that.locate("toggleAlternateIcon").hide()};var localizeButtons=function(that){$("img",that.backButton).attr("alt",that.options.strings.goBack);$("img",that.homeButton).attr("alt",that.options.strings.goHome);that.defaultIcon.attr("alt",that.options.strings.defaultToggle);that.alternateIcon.attr("alt",that.options.strings.alternateToggle)};var setupNavigationBar=function(that){that.backButton=that.locate("backButton").click(preventingHandler(that.back));that.homeButton=that.locate("homeButton").click(preventingHandler(that.home));that.locate("toggleButton").click(preventingHandler(that.toggle));setupToggle(that);localizeButtons(that)};var toggleIcons=function(that){that.defaultIcon.toggle();that.alternateIcon.toggle()};fluid.engage.navigationBar=function(container,options){var that=fluid.initView("fluid.engage.navigationBar",container,options);if(that.options.disabled){that.locate("bar").hide();return null}that.home=function(){fluid.engage.url.location("../app/home.html?lang="+fluid.engage.url.params().lang)};that.back=function(){fluid.engage.url.history.go(-1)};that.toggle=function(){toggleIcons(that);that.events.onToggle.fire()};setupNavigationBar(that);return that};fluid.defaults("fluid.engage.navigationBar",{selectors:{bar:".flc-navigationBar",backButton:".flc-navigationBar-back",homeButton:".flc-navigationBar-home",toggleButton:".flc-navigationBar-toggle",toggleDefaultIcon:".flc-navigationBar-toggle-list",toggleAlternateIcon:".flc-navigationBar-toggle-grid"},strings:{goBack:"Go back",goHome:"Go home",defaultToggle:"Switch to grid layout",alternateToggle:"Switch to list layout"},disabled:false,events:{onToggle:null}})})(jQuery);"use strict";fluid=fluid||{};(function($){var generateTree=function(model,options){return{children:fluid.transform(model,function(navListItem){var itemSubtree={ID:"listItems:",children:[{ID:"link",target:navListItem.target||""},{ID:"titleText",value:navListItem.title||""}]};if(navListItem.description){itemSubtree.children.push({ID:"descriptionText",value:navListItem.description})}if(navListItem.image||options.useDefaultImage){itemSubtree.children.push({ID:"image",target:navListItem.image,decorators:{type:"attrs",attributes:{alt:navListItem.title||""}}})}if(navListItem.showBadge){itemSubtree.children.push({ID:"badgeIcon",target:options.badgeIconUrl})}return itemSubtree})}};var setup=function(that){that.render=fluid.engage.renderUtils.createRendererFunction(that.container,that.options.selectors,{repeatingSelectors:["listItems"],selectorsToIgnore:["listGroup","linkContainer","gridToggle"]});that.refreshView();that.locate("gridToggle").click(that.toggleLayout);if(that.isGrid){that.gridLayout()}else{that.listLayout()}};var styleAsGrid=function(listGroup,linkContainer,link,styles){listGroup.addClass(styles.grid).removeClass(styles.list);linkContainer.addClass(styles.gridTable);link.addClass(styles.gridCell)};var styleAsList=function(listGroup,linkContainer,link,styles){listGroup.addClass(styles.list).removeClass(styles.grid);linkContainer.removeClass(styles.gridTable);link.removeClass(styles.gridCell)};fluid.navigationList=function(container,options){var that=fluid.initView("fluid.navigationList",container,options);that.model=that.options.model;that.isGrid=that.options.defaultToGrid;that.toggleLayout=function(){if(that.isGrid){that.listLayout()}else{that.gridLayout()}};that.gridLayout=function(){styleAsGrid(that.locate("listGroup"),that.locate("linkContainer"),that.locate("link"),that.options.styles);that.isGrid=true};that.listLayout=function(){styleAsList(that.locate("listGroup"),that.locate("linkContainer"),that.locate("link"),that.options.styles);that.isGrid=false};that.refreshView=function(){that.render(generateTree(that.model,that.options));that.events.afterRender.fire()};setup(that);return that};fluid.defaults("fluid.navigationList",{selectors:{listGroup:".flc-navigationList-listGroup",listItems:".flc-navigationList-items",linkContainer:".flc-navigationList-linkContainer",link:".flc-navigationList-link",image:".flc-navigationList-image",titleText:".flc-navigationList-titleText",descriptionText:".flc-navigationList-descriptionText",gridToggle:".flc-navigationList-gridToggle",badgeIcon:".flc-navigationList-badge-icon"},styles:{grid:"fl-thumbnails-expanded fl-grid",gridTable:"fl-table",gridCell:"fl-table-cell",list:"fl-list"},defaultToGrid:false,strings:{},events:{afterRender:null},useDefaultImage:false,badgeIconUrl:undefined,model:[{target:"",image:"",title:"",description:null}]})})(jQuery);fluid=fluid||{};(function($){var findChild=function(element,test){element=fluid.unwrap(element);var childNodes=element.childNodes;for(var i=0;i<childNodes.length;i++){if(test(childNodes[i])){return childNodes[i]}}};var addAria=function(that){that.container.attr({role:"tablist","aria-multiselectable":"true"});that.locate("drawer").attr({role:"tab","aria-expanded":"false"})};var addCSS=function(that){that.locate("drawer").not(that.shelves||"").addClass(that.options.styles.drawer);that.locate("contents").addClass(that.options.styles.contents);that.locate("handle").addClass(that.options.styles.handle);if(that.shelves){that.shelves.addClass(that.options.styles.shelf)}};var toggleVisibility=function(that,selector){selector=fluid.wrap(selector);selector.each(function(index,element){var contents=findChild(element,function(element){return $(element).is(that.options.selectors.contents)});if(contents){$(contents).toggle()}})};var drawerAdjust=function(that,selector,addedStyleName,removedStyleName,ariaString,eventName){selector=fluid.wrap(selector);selector.addClass(that.options.styles[addedStyleName]);selector.removeClass(that.options.styles[removedStyleName]);selector.attr("aria-expanded",ariaString);toggleVisibility(that,selector);if(eventName){that.events[eventName].fire(selector)}};var open=function(that,selector,stopEvent){drawerAdjust(that,selector,"drawerOpened","drawerClosed","true",stopEvent?null:"afterOpen")};var close=function(that,selector,stopEvent){selector=that.shelves?fluid.wrap(selector).not(that.shelves):selector;drawerAdjust(that,selector,"drawerClosed","drawerOpened","false",stopEvent?null:"afterClose")};var moveDrawers=function(that,moveFunc,selector,stopEvent){moveFunc(that,selector,stopEvent)};var findHandleBase=function(that,element){return $(fluid.findAncestor(element,function(el){return $(el).is(that.options.selectors.drawer)}))};var addClickEvent=function(that){that.locate("handle").click(function(){that.toggleDrawers(findHandleBase(that,this))})};var addKeyNav=function(that){that.container.attr("tabindex",0);that.container.fluid("selectable",{selectableSelector:that.options.selectors.handle});that.locate("handle").fluid("activatable",function(evt){that.toggleDrawers(findHandleBase(that,evt.target))})};var findShelves=function(that){var shelvesList;that.locate("drawer").each(function(){var drawer=$(this);if(drawer.find(that.options.selectors.handle).length===0){shelvesList=shelvesList?shelvesList.add(drawer):drawer}});that.shelves=shelvesList};var setup=function(that){findShelves(that);addAria(that);addCSS(that);moveDrawers(that,that.options.startOpen?open:close,that.locate("drawer"),that.options.preventEventFireOnInit);if(that.options.startOpen){that.openDrawers(that.locate("openByDefault"))}addClickEvent(that);if(fluid.a11y){addKeyNav(that)}};fluid.cabinet=function(container,options){var that=fluid.initView("fluid.cabinet",container,options);that.toggleDrawers=function(drawer){drawer=fluid.wrap(drawer);drawer.each(function(index,element){var elm=$(element);if(elm.hasClass(that.options.styles.drawerClosed)){that.openDrawers(elm)}else{if(elm.hasClass(that.options.styles.drawerOpened)){that.closeDrawers(elm)}}})};that.openDrawers=function(selector){moveDrawers(that,open,selector)};that.closeDrawers=function(selector){moveDrawers(that,close,selector)};setup(that);return that};fluid.defaults("fluid.cabinet",{selectors:{drawer:".flc-cabinet-drawer",handle:".flc-cabinet-handle",header:".flc-cabinet-header",headerDescription:".flc-cabinet-headerDescription",contents:".flc-cabinet-contents",openByDefault:""},styles:{drawerClosed:"fl-cabinet-drawerClosed",drawerOpened:"fl-cabinet-drawerOpened",drawer:"fl-container fl-container-autoHeading fl-cabinet-animation fl-container-collapsable",shelf:"fl-container",contents:"fl-cabinet-contents",handle:"fl-cabinet-handle"},events:{afterOpen:null,afterClose:null},startOpen:false,preventEventFireOnInit:true})})(jQuery);"use strict";fluid=fluid||{};(function($){if(!$.datepicker){$.datepicker={regional:{},setDefaults:function(){}}}})(jQuery);jQuery.datepicker.regional["en-GB"]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};jQuery.datepicker.regional.fr={closeText:"Fermer",prevText:"&#x3c;Préc",nextText:"Suiv&#x3e;",currentText:"Courant",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};"use strict";var fluid=fluid||{};(function($){fluid.dateUtils=fluid.dateUtils||{};fluid.dateUtils.fromDate=function(date){var togo={};togo.fullYear=Number(date.getFullYear());togo.month=Number(date.getMonth()+1);togo.day=Number(date.getDate());togo.dayNumber=Number(date.getDay());togo.hours=Number(date.getHours());togo.minutes=Number(date.getMinutes());togo.seconds=Number(date.getSeconds());return togo};fluid.dateUtils.parseISO8601=function(string){var regexp="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var d=string.match(new RegExp(regexp));var offset=0;var date=new Object();date.fullYear=Number(d[1]);date.month=Number(d[3]);date.day=Number(d[5]);date.hours=Number(d[7]);date.minutes=Number(d[8]);date.seconds=Number(d[10]);date.milliseconds=Number(d[12]);return date};fluid.dateUtils.renderISO8601=function(fixeddate,format,offset){if(!format){var format=6}if(!offset){var offset="Z"}else{var d=offset.match(/([-+])([0-9]{2}):([0-9]{2})/);var offsetnum=(Number(d[2])*60)+Number(d[3]);offsetnum*=((d[1]=="-")?-1:1)}var str="";str+=fixeddate.fullYear;if(format>1){str+="-"+zeropad(fixeddate.month)}if(format>2){str+="-"+zeropad(fixeddate.day)}if(format>3){str+="T"+zeropad(fixeddate.hours)+":"+zeropad(fixeddate.minutes)}if(format>4){str+=":"+zeropad(fixeddate.seconds);if(format==6){str+="."+zeropad(fixeddate.milliseconds,3)}}if(format>3){str+=offset}return str};var zeropad=function(num,width){if(!width){width=2}var numstr=(num==undefined?"":num.toString());return"00000".substring(5-width+numstr.length)+numstr};fluid.dateUtils.getLocalisedDateElement=function(locale,element,index){if(locale==="en"){locale="en-GB"}return window.jQuery.datepicker.regional[locale][element][index]};fluid.dateUtils.renderLocalisedDate=function(fixedDate,format,locale){var l=fluid.dateUtils.getLocalisedDateElement;return format.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(format){switch(format){case"hh":return zeropad(fixedDate.hours<13?fixedDate.hours:(fixedDate.hours-12));case"h":return fixedDate.hours<13?fixedDate.hours:(fixedDate.hours-12);case"HH":return zeropad(fixedDate.hours);case"H":return fixedDate.hours;case"mm":return zeropad(fixedDate.minutes);case"m":return fixedDate.minutes;case"ss":return zeropad(fixedDate.seconds);case"s":return fixedDate.seconds;case"yyyy":return fixedDate.fullYear;case"yy":return fixedDate.fullYear.toString().substring(2,4);case"dddd":return l(locale,"dayNames",fixedDate.dayNumber);case"ddd":return l(locale,"dayNamesShort",fixedDate.dayNumber);case"dd":return zeropad(fixedDate.day);case"d":return fixedDate.day;case"MMMM":return l(locale,"monthNames",fixedDate.month-1);case"MMM":return l(locale,"monthNamesShort",fixedDate.month-1);case"MM":return zeropad(fixedDate.month);case"M":return fixedDate.month;case"zzz":case"zz":case"z":return""}})}})(jQuery);"use strict";fluid=fluid||{};(function($){fluid.setLogging(true);var messageActions={deleteAction:function(applier,comment,model){applier.requestChange("deleted",true)},reportAbuseAction:function(applier,comment,model){applier.requestChange("abuseReported."+model.ownId,true)},abuseReportedAction:function(){}};var makeCommentAction=function(model,comment,dataSource){var applier=fluid.kettle.makeSourceApplier(dataSource,{},comment);applier.modelChanged.addListener(function(){document.location.reload()});var messagekey=model.ownId===comment.authorId?"delete":comment.abuseReported?"abuseReported":"reportAbuse";var togo={messagekey:messagekey,decorators:[{jQuery:["click",function(){messageActions[messagekey+"Action"](applier,comment,model);return false}]}]};if(messagekey==="abuseReported"){togo.decorators.push({removeClass:"fl-guestbook-action"})}return togo};var makeProtoComponents=function(model,options,commentDataSource){return{title:{messagekey:"title"},addNote:{target:options.addNoteTarget},addNoteText:{messagekey:"addNote"},"commentCell:":{children:fluid.transform(model.comments,function(comment){return{author:comment.author,location:comment.location,date:fluid.dateUtils.renderLocalisedDate(fluid.dateUtils.parseISO8601(comment.date),options.dateFormat,options.locale),commentText:comment.text,action:makeCommentAction(model,comment,commentDataSource)}})}}};var setupSubcomponents=function(that){that.navBar=fluid.initSubcomponent(that,"navigationBar",[that.container,fluid.COMPONENT_OPTIONS])};var setup=function(that){var messageLocator=fluid.messageLocator(that.options.strings,fluid.stringTemplate);that.render=fluid.engage.renderUtils.createRendererFunction(that.container,that.options.selectors,{repeatingSelectors:["commentCell"],templateSource:that.options.templateSource?that.options.templateSource:{node:that.container},rendererOptions:{messageLocator:messageLocator,model:that.model,debugMode:false}});that.refreshView();that.events.afterRender.fire(that)};fluid.engage.disturbUrl=function(url){var qpos=url.indexOf("?");var dpos=url.indexOf("&disturb");if(dpos!==-1){url=url.substring(0,dpos)}url+=(qpos===-1?"?":"&")+"disturb="+Math.floor(Math.random()*1000000);return url};fluid.engage.guestbook=function(container,options){var that=fluid.initView("fluid.engage.guestbook",container,options);if(that.options.locale!=="fr"){that.options.locale="en"}that.model=that.options.model;that.model.ownId=fluid.engage.user.currentUser()._id;var returnUrl=fluid.engage.disturbUrl(fluid.engage.url.location());that.options.addNoteTarget=that.options.addNoteTarget+"&"+$.param({returnUrl:returnUrl});var expander=fluid.renderer.makeProtoExpander({ELstyle:"%"});var commentDataSource=fluid.kettle.simpleURLDataSource(that.options.postURL);that.refreshView=function(){var protoTree=makeProtoComponents(that.model,that.options,commentDataSource);var tree=expander(protoTree);that.render(tree);setupSubcomponents(that)};setup(that);return that};fluid.defaults("fluid.engage.guestbook",{navigationBar:{type:"fluid.engage.navigationBar"},selectors:{title:".flc-guestbook-title",addNote:".flc-guestbook-addnote-control",addNoteText:".flc-guestbook-addnote-text",commentCell:".flc-guestbook-comment-cell",author:".flc-guestbook-author",location:".flc-guestbook-location",date:".flc-guestbook-date",commentText:".flc-guestbook-text",action:".flc-guestbook-action"},postURL:"",addNoteTarget:"comment.html?param1=1",locale:"en",dateFormat:"MMMM dd, yyyy",events:{afterRender:null},strings:{addNote:"Add Note","delete":"Delete",reportAbuse:"Report Abuse",abuseReported:"Abuse reported. Pending moderator review",cancel:"Cancel",submit:"Submit",commentEntry:"Comment Entry"}});fluid.engage.setText=function(node,text){if(node.length){/^input$/i.test(node[0].tagName)?node.attr("value",text):node.text(text)}};fluid.engage.quickI18N=function(dom,strings,map){fluid.transform(map,function(key,value){fluid.engage.setText(dom.locate(key),strings[value])})};var bindCommentHandlers=function(that){that.locate("cancel").click(function(){that.goBack();return false});that.locate("form").submit(function(){that.submit();return false})};var submitComment=function(that){var text=that.locate("text").val();fluid.log("Submitting text "+text+" to URL "+that.options.postURL);var fixedDate=fluid.dateUtils.fromDate(new Date());var isoDate=fluid.dateUtils.renderISO8601(fixedDate);var user=fluid.engage.user.currentUser();var doc=$.extend({text:text,date:isoDate,authorId:user._id},that.options.docRoot);fluid.kettle.operateUrl(that.options.postURL,null,{type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(doc)},that.goBack)};fluid.engage.guestbookComment=function(container,options){var that=fluid.initView("fluid.engage.guestbookComment",container,options);that.model=that.options.model;that.navBar=fluid.initSubcomponent(that,"navigationBar",[that.container,fluid.COMPONENT_OPTIONS]);bindCommentHandlers(that);fluid.engage.quickI18N(that.dom,that.options.strings,{cancel:"cancel",submit:"submit",commentEntry:"commentEntry"});that.submit=function(){submitComment(that)};var params=fluid.engage.url.params();that.goBack=function(){if(params.returnUrl){fluid.engage.url.location(params.returnUrl)}else{fluid.engage.url.history.back()}};return that};fluid.defaults("fluid.engage.guestbookComment",{navigationBar:{type:"fluid.engage.navigationBar"},selectors:{text:".flc-guestbook-text",cancel:".flc-guestbook-cancel",submit:".flc-guestbook-submit",commentEntry:".flc-guestbook-commentEntry",form:".flc-guestbook-form"},userid:"anonymous",postURL:"#",docRoot:{userName:"Anonymous"},strings:{cancel:"Cancel",submit:"Submit",commentEntry:"Comment Entry",},})}(jQuery));